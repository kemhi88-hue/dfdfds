name: Run Register Bot AI

on:
  workflow_dispatch: # Cho phép nhấn nút "Run workflow" thủ công
  push:
    branches:
      - main # Tự động chạy khi bạn commit code vào nhánh main

jobs:
  register-job:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install System Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y libgl1-mesa-glx # Bắt buộc phải có để chạy OpenCV trên Linux

      - name: Install Python Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install playwright opencv-python numpy ddddocr requests
          playwright install chromium

      - name: Run Registration Script
        run: |
          # vsagwtjq63 là mã mời mặc định, bạn có thể thay đổi ở đây
          python register.py vsagwtjq63
        env:
          PYTHONUNBUFFERED: 1

      - name: Upload Result Screenshot
        if: always() # Luôn chạy bước này kể cả khi script lỗi để xem kết quả
        uses: actions/upload-artifact@v3
        with:
          name: registration-result
          path: |
            ketqua.png
            bg.png
            slice.png
