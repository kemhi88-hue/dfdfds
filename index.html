<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>VSPhone ‚Äì Qu·∫£n l√Ω t√†i kho·∫£n</title>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Segoe UI', Arial, sans-serif;
  background: linear-gradient(135deg, #0f172a, #1e293b);
  color: #e5e7eb;
  padding: 20px;
}
.container { max-width: 1200px; margin: auto; }
h2 { color: #22c55e; margin-bottom: 10px; }
.note { font-size: 13px; color: #94a3b8; margin-bottom: 20px; }
.table-wrapper {
  background: #1e293b;
  border-radius: 12px;
  overflow: hidden;
}
table { width: 100%; border-collapse: collapse; }
th, td {
  padding: 12px 16px;
  border-bottom: 1px solid #334155;
}
th {
  background: #0f172a;
  color: #22c55e;
  font-size: 12px;
  text-transform: uppercase;
}
tbody tr:hover { background: #334155; }
.status-active { color: #22c55e; font-weight: bold; }
.status-inactive { color: #ef4444; }
.btn {
  padding: 8px 14px;
  background: #22c55e;
  color: #022c22;
  border: none;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
}
.btn:hover { background: #16a34a; }
.loading { text-align: center; color: #94a3b8; padding: 30px; }
.error {
  color: #fecaca;
  background: #7f1d1d;
  padding: 12px;
  border-radius: 8px;
}
.password-cell {
  font-family: monospace;
  color: #94a3b8;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>

<body>
<div class="container">
  <h2>üì± VSPhone ‚Äì Qu·∫£n l√Ω t√†i kho·∫£n</h2>
  <p class="note">D·ªØ li·ªáu load t·ª´ Google Sheets (Publish to web)</p>

  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>N·ªÅn t·∫£ng</th>
          <th>Email</th>
          <th>Password</th>
          <th>Tr·∫°ng th√°i</th>
          <th style="text-align:center">Thao t√°c</th>
        </tr>
      </thead>
      <tbody id="tbody">
        <tr><td colspan="5" class="loading">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const CSV_URL =
'https://docs.google.com/spreadsheets/d/e/2PACX-1vSyIS6NTiGHKz7BR5e8PEshKhRJWJcUC9bR8Gp5_WuqfsEGOwRdaARGcR-CwV7Dn_gUYRxcZ12Yb20I/pub?output=csv&gid=0';

/* ================= LOGIN ================= */
function openLogin(email, password) {
  // l∆∞u cho userscript
  localStorage.setItem('VS_LOGIN_EMAIL', email);
  localStorage.setItem('VS_LOGIN_PASS', password);
  localStorage.setItem('VS_LOGIN_TIME', Date.now());

  // m·ªü trang ch√≠nh VSPhone
  window.open('https://cloud.vsphone.com/', '_blank');
}

/* ================= UTIL ================= */
function esc(s) {
  return String(s ?? '')
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;');
}

/* ================= RENDER ================= */
function render(rows) {
  const tbody = document.getElementById('tbody');
  tbody.innerHTML = '';

  if (!rows.length) {
    tbody.innerHTML = '<tr><td colspan="5" class="error">Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>';
    return;
  }

  const keys = Object.keys(rows[0]);
  const kPlatform = keys.find(k => /platform|n·ªÅn/i.test(k)) || keys[0];
  const kEmail = keys.find(k => /email/i.test(k));
  const kPass = keys.find(k => /pass|m·∫≠t/i.test(k));
  const kStatus = keys.find(k => /status|tr·∫°ng/i.test(k));

  rows.forEach(r => {
    if (!r[kEmail] || !r[kPass]) return;

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><b>${esc(r[kPlatform])}</b></td>
      <td>${esc(r[kEmail])}</td>
      <td class="password-cell">${'‚Ä¢'.repeat(r[kPass].length)}</td>
      <td class="${/on|active|ho·∫°t/i.test(r[kStatus]) ? 'status-active':'status-inactive'}">
        ${esc(r[kStatus] || '')}
      </td>
      <td style="text-align:center">
        <button class="btn">üöÄ LOGIN</button>
      </td>
    `;
    tr.querySelector('button').onclick = () =>
      openLogin(r[kEmail], r[kPass]);

    tbody.appendChild(tr);
  });
}

/* ================= LOAD CSV ================= */
fetch(CSV_URL)
  .then(r => r.text())
  .then(t => {
    const p = Papa.parse(t, { header:true, skipEmptyLines:true });
    render(p.data);
  })
  .catch(e => {
    document.getElementById('tbody').innerHTML =
      `<tr><td colspan="5" class="error">L·ªói load CSV</td></tr>`;
    console.error(e);
  });
</script>
</body>
</html>
