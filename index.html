<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>VSPhone ‚Äì Qu·∫£n l√Ω t√†i kho·∫£n (CSV)</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #fff;
  color: #000;
  padding: 20px;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}
th, td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: left;
}
th {
  background: #eee;
}
.btn {
  padding: 4px 8px;
  background: #007bff;
  color: #fff;
  border: none;
  cursor: pointer;
}
.btn:hover {
  background: #0056b3;
}
.error {
  color: red;
}
</style>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>

<h2>VSPhone ‚Äì Qu·∫£n l√Ω t√†i kho·∫£n</h2>
<p>D·ªØ li·ªáu load t·ª´ Google Sheets (CSV publish).</p>

<table>
  <thead>
    <tr>
      <th>N·ªÅn t·∫£ng</th>
      <th>Email</th>
      <th>Password</th>
      <th>Tr·∫°ng th√°i</th>
      <th>Thao t√°c</th>
    </tr>
  </thead>
  <tbody id="tbody">
    <tr><td colspan="5">ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>
  </tbody>
</table>

<script>
/* =========================
   LOAD GOOGLE SHEET DATA
========================= */

const SHEET_JSON_URL =
  'https://opensheet.elk.sh/1fU4ppbOWDikPkEWUdXiyqrUn8JHXvt-PJjS778J-R8M/Sheet1';

function escapeHtml(str) {
  return String(str ?? '')
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;");
}

async function loadSheet() {
  const res = await fetch(SHEET_JSON_URL);
  const data = await res.json();
  renderTableFromObjects(data);
}

function renderTableFromObjects(rows) {
  const tbody = document.querySelector('#accountTable tbody');
  tbody.innerHTML = '';

  rows.forEach((row, index) => {
    const email =
      row.email ||
      row.Email ||
      row.EMAIL ||
      row.mail ||
      row.Mail ||
      row.t√†i_kho·∫£n ||
      row.taikhoan ||
      '';

    const password =
      row.password ||
      row.pass ||
      row.Pass ||
      row.mk ||
      row.m·∫≠t_kh·∫©u ||
      row.mat_khau ||
      '';

    /* üî• DEBUG ‚Äì B·∫ÆT BU·ªòC GI·ªÆ L·∫†I */
    console.log('[DEBUG ROW]', row);
    console.log('[DEBUG EMAIL]', email);
    console.log('[DEBUG PASS]', password);

    if (!email || !password) {
      console.warn('[SKIP] Missing email or password', row);
      return;
    }

    /* ‚ùå TR∆Ø·ªöC ƒê√ÇY B·∫†N CHE PASSWORD ‚Üí KH√ì DEBUG */
    /* const pwdDots = '‚Ä¢'.repeat(String(password).length); */

    /* ‚úÖ S·ª¨A: HI·ªÇN TH·ªä PASSWORD TH·∫¨T */
    const pwdText = escapeHtml(password);

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${index + 1}</td>
      <td>${escapeHtml(email)}</td>
      <td class="password-cell">${pwdText}</td>
      <td>
        <button class="login-btn"
          data-email="${escapeHtml(email)}"
          data-pass="${escapeHtml(password)}">
          üöÄ Login
        </button>
      </td>
    `;
    tbody.appendChild(tr);
  });

  bindLoginButtons();
}

function bindLoginButtons() {
  document.querySelectorAll('.login-btn').forEach(btn => {
    btn.onclick = () => {
      const email = btn.dataset.email;
      const pass = btn.dataset.pass;

      console.log('[SAVE LOGIN]', email, pass);

      localStorage.setItem('VS_LOGIN_EMAIL', email);
      localStorage.setItem('VS_LOGIN_PASS', pass);

      window.open('https://cloud.vsphone.com/login', '_blank');
    };
  });
}

loadSheet();
</script>


</body>
</html>
