<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VSPhone ‚Äì Qu·∫£n l√Ω t√†i kho·∫£n</title>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Segoe UI', Arial, sans-serif;
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
  color: #e5e7eb;
  padding: 20px;
  min-height: 100vh;
}
.container { max-width: 1200px; margin: 0 auto; }
h2 { font-size: 28px; margin-bottom: 10px; color: #22c55e; }
.note { font-size: 13px; color: #94a3b8; margin-bottom: 20px; }

.table-wrapper {
  background: #1e293b;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 6px rgba(0,0,0,0.3);
}
table { width: 100%; border-collapse: collapse; }
th, td {
  padding: 12px 16px;
  text-align: left;
  border-bottom: 1px solid #334155;
}
th {
  background: #0f172a;
  color: #22c55e;
  font-size: 12px;
  text-transform: uppercase;
}
tbody tr:hover { background: #334155; }

.status-active { color: #22c55e; font-weight: 600; }
.status-inactive { color: #ef4444; }

.btn {
  padding: 8px 16px;
  background: #22c55e;
  color: #022c22;
  border: none;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
}
.btn:hover { background: #16a34a; }

.loading { text-align: center; padding: 30px; color: #94a3b8; }
.error {
  color: #ef4444;
  background: #7f1d1d;
  padding: 12px;
  border-radius: 8px;
}
.password-cell {
  font-family: monospace;
  color: #94a3b8;
}
</style>
</head>

<body>
<div class="container">
  <h2>üì± VSPhone ‚Äì Qu·∫£n l√Ω t√†i kho·∫£n</h2>
  <p class="note">D·ªØ li·ªáu load tr·ª±c ti·∫øp t·ª´ Google Sheet (CSV + Proxy)</p>

  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>N·ªÅn t·∫£ng</th>
          <th>Email</th>
          <th>Password</th>
          <th>Tr·∫°ng th√°i</th>
          <th style="text-align:center">Thao t√°c</th>
        </tr>
      </thead>
      <tbody id="tbody">
        <tr><td colspan="5" class="loading">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
/* ================== CSV LINK (G·ªêC) ================== */
const ORIGINAL_CSV =
  'https://docs.google.com/spreadsheets/d/e/2PACX-1vSyIS6NTiGHKz7BR5e8PEshKhRJWJcUC9bR8Gp5_WuqfsEGOwRdaARGcR-CwV7Dn_gUYRxcZ12Yb20I/pub?output=csv';

/* ================== PROXY BYPASS CORS ================== */
const CSV_URL =
  'https://api.allorigins.win/raw?url=' +
  encodeURIComponent(ORIGINAL_CSV);

/* ================== FUNCTIONS ================== */
function parseCSVLine(line) {
  const regex = /(".*?"|[^",]+)(?=\s*,|\s*$)/g;
  const result = line.match(regex);
  return result ? result.map(v => v.replace(/^"|"$/g, '').trim()) : [];
}

function openLogin(email, password) {
  const url =
    `https://cloud.vsphone.com/login?email=${encodeURIComponent(email)}&pass=${encodeURIComponent(password)}`;
  window.open(url, '_blank');
}

/* ================== LOAD DATA ================== */
fetch(CSV_URL)
  .then(res => {
    if (!res.ok) throw new Error('Fetch CSV failed');
    return res.text();
  })
  .then(text => {
    text = text.replace(/\uFEFF/g, '').trim();
    const lines = text.split(/\r?\n/);
    const tbody = document.getElementById('tbody');
    tbody.innerHTML = '';

    if (lines.length < 2) {
      tbody.innerHTML =
        '<tr><td colspan="5" class="error">‚ö†Ô∏è Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>';
      return;
    }

    let count = 0;

    for (let i = 1; i < lines.length; i++) {
      const cols = parseCSVLine(lines[i]);
      if (cols.length < 4) continue;

      const [platform, email, password, status] = cols;
      if (!email || !password) continue;

      count++;

      const statusClass =
        /active|ho·∫°t/i.test(status) ? 'status-active' : 'status-inactive';

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><strong>${platform || 'VSPhone'}</strong></td>
        <td>${email}</td>
        <td class="password-cell">${'‚Ä¢'.repeat(password.length)}</td>
        <td class="${statusClass}">${status}</td>
        <td style="text-align:center">
          <button class="btn"
            onclick="openLogin('${email.replace(/'/g,"\\'")}','${password.replace(/'/g,"\\'")}')">
            üöÄ LOGIN
          </button>
        </td>
      `;
      tbody.appendChild(tr);
    }

    if (count === 0) {
      tbody.innerHTML =
        '<tr><td colspan="5" class="loading">Kh√¥ng c√≥ t√†i kho·∫£n h·ª£p l·ªá</td></tr>';
    }

    console.log('[VSPhone Manager] Loaded accounts:', count);
  })
  .catch(err => {
    console.error(err);
    document.getElementById('tbody').innerHTML =
      '<tr><td colspan="5" class="error">‚ùå L·ªói t·∫£i d·ªØ li·ªáu</td></tr>';
  });
</script>

</body>
</html>
