<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VSPhone ‚Äì Qu·∫£n l√Ω t√†i kho·∫£n</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Segoe UI', Arial, sans-serif;
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
  color: #e5e7eb;
  padding: 20px;
  min-height: 100vh;
}
.container {
  max-width: 1200px;
  margin: 0 auto;
}
h2 {
  font-size: 28px;
  margin-bottom: 10px;
  color: #22c55e;
}
.note {
  font-size: 13px;
  color: #94a3b8;
  margin-bottom: 20px;
}
.table-wrapper {
  background: #1e293b;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 6px rgba(0,0,0,0.3);
}
table {
  width: 100%;
  border-collapse: collapse;
}
th, td {
  padding: 12px 16px;
  text-align: left;
  border-bottom: 1px solid #334155;
}
th {
  background: #0f172a;
  color: #22c55e;
  font-weight: 600;
  text-transform: uppercase;
  font-size: 12px;
  letter-spacing: 0.5px;
}
tbody tr {
  transition: background 0.2s;
}
tbody tr:hover {
  background: #334155;
}
.status-active {
  color: #22c55e;
  font-weight: 600;
}
.status-inactive {
  color: #ef4444;
}
.btn {
  padding: 8px 16px;
  background: #22c55e;
  color: #022c22;
  border: none;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 13px;
}
.btn:hover {
  background: #16a34a;
  transform: translateY(-1px);
}
.btn:active {
  transform: translateY(0);
}
.loading {
  text-align: center;
  padding: 40px;
  color: #94a3b8;
}
.error {
  color: #ef4444;
  background: #7f1d1d;
  padding: 12px;
  border-radius: 8px;
  margin-top: 20px;
}
.footer-note {
  margin-top: 20px;
  padding: 15px;
  background: #1e293b;
  border-radius: 8px;
  border-left: 4px solid #22c55e;
}
.password-cell {
  font-family: 'Courier New', monospace;
  color: #94a3b8;
}
</style>
</head>
<body>

<div class="container">
  <h2>üì± VSPhone ‚Äì Qu·∫£n l√Ω t√†i kho·∫£n</h2>
  <p class="note">D·ªØ li·ªáu ƒë∆∞·ª£c ƒë·ªìng b·ªô tr·ª±c ti·∫øp t·ª´ Google Sheet</p>

  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>N·ªÅn t·∫£ng</th>
          <th>Email</th>
          <th>Password</th>
          <th>Tr·∫°ng th√°i</th>
          <th style="text-align: center;">Thao t√°c</th>
        </tr>
      </thead>
      <tbody id="tbody">
        <tr>
          <td colspan="5" class="loading">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu...</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="footer-note">
    <strong>üìå H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng:</strong><br>
    1. Nh·∫•n n√∫t <strong>LOGIN</strong> ƒë·ªÉ m·ªü trang ƒëƒÉng nh·∫≠p VSPhone<br>
    2. Tampermonkey script s·∫Ω t·ª± ƒë·ªông ƒëi·ªÅn th√¥ng tin v√† ƒëƒÉng nh·∫≠p<br>
    3. <span style="color:#fbbf24">‚ö†Ô∏è L∆∞u √Ω b·∫£o m·∫≠t:</span> T√†i kho·∫£n ƒë∆∞·ª£c l∆∞u trong localStorage c·ªßa tr√¨nh duy·ªát
  </div>
</div>

<script>
const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSyIS6NTiGHKz7BR5e8PEshKhRJWJcUC9bR8Gp5_WuqfsEGOwRdaARGcR-CwV7Dn_gUYRxcZ12Yb20I/pub?output=csv';

function parseCSVLine(line) {
  const regex = /(".*?"|[^",]+)(?=\s*,|\s*$)/g;
  const result = line.match(regex);
  return result ? result.map(v => v.replace(/^"|"$/g, '').trim()) : [];
}

function openLogin(email, password) {
  // Encode ƒë·ªÉ tr√°nh l·ªói URL
  const encodedEmail = encodeURIComponent(email);
  const encodedPass = encodeURIComponent(password);
  
  // Truy·ªÅn credentials qua URL parameters
  const loginUrl = `https://cloud.vsphone.com/login?email=${encodedEmail}&pass=${encodedPass}`;
  
  console.log('[VSP Manager] Opening login page with credentials...');
  window.open(loginUrl, '_blank');
}

// Load v√† hi·ªÉn th·ªã d·ªØ li·ªáu
fetch(CSV_URL)
  .then(res => {
    if (!res.ok) throw new Error('Failed to fetch CSV');
    return res.text();
  })
  .then(text => {
    text = text.replace(/\uFEFF/g, '').trim();
    const lines = text.split(/\r?\n/);
    const tbody = document.getElementById('tbody');
    tbody.innerHTML = '';

    if (lines.length < 2) {
      tbody.innerHTML = '<tr><td colspan="5" class="error">‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu trong Google Sheet</td></tr>';
      return;
    }

    let accountCount = 0;
    for (let i = 1; i < lines.length; i++) {
      const cols = parseCSVLine(lines[i]);
      if (cols.length < 4) continue;

      const [platform, email, password, status] = cols;
      
      // B·ªè qua d√≤ng tr·ªëng
      if (!email || !password) continue;

      accountCount++;
      const statusClass = status.toLowerCase().includes('active') || status.toLowerCase().includes('ho·∫°t') 
        ? 'status-active' : 'status-inactive';

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><strong>${platform || 'VSPhone'}</strong></td>
        <td>${email}</td>
        <td class="password-cell">${'‚Ä¢'.repeat(password.length)}</td>
        <td class="${statusClass}">${status}</td>
        <td style="text-align: center;">
          <button class="btn" onclick="openLogin('${email.replace(/'/g, "\\'")}','${password.replace(/'/g, "\\'")}')">
            üöÄ LOGIN
          </button>
        </td>
      `;
      tbody.appendChild(tr);
    }

    if (accountCount === 0) {
      tbody.innerHTML = '<tr><td colspan="5" class="loading">Kh√¥ng c√≥ t√†i kho·∫£n n√†o trong danh s√°ch</td></tr>';
    }

    console.log(`[VSP Manager] Loaded ${accountCount} accounts`);
  })
  .catch(err => {
    console.error('CSV LOAD ERROR:', err);
    document.getElementById('tbody').innerHTML = 
      `<tr><td colspan="5" class="error">‚ùå L·ªói t·∫£i d·ªØ li·ªáu: ${err.message}</td></tr>`;
  });
</script>

</body>
</html>
