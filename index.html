<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>VSPhone – Quản lý tài khoản</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #fff;
  color: #000;
  padding: 20px;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}
th, td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: left;
}
th {
  background: #eee;
}
.btn {
  padding: 4px 10px;
  background: #007bff;
  color: #fff;
  border: none;
  cursor: pointer;
}
.btn:hover {
  background: #0056b3;
}
.password-cell {
  font-family: monospace;
}
</style>
</head>

<body>

<h2>VSPhone – Quản lý tài khoản</h2>
<p>Dữ liệu load trực tiếp từ Google Sheets.</p>

<table id="accountTable">
  <thead>
    <tr>
      <th>#</th>
      <th>Nền tảng</th>
      <th>Email</th>
      <th>Password</th>
      <th>Trạng thái</th>
      <th>Thao tác</th>
    </tr>
  </thead>
  <tbody id="tbody">
    <tr><td colspan="6">Đang tải dữ liệu...</td></tr>
  </tbody>
</table>

<script>
/* =========================
   LOAD GOOGLE SHEET DATA
========================= */

const SHEET_JSON_URL =
  'https://opensheet.elk.sh/1fU4ppbOWDikPkEWUdXiyqrUn8JHXvt-PJjS778J-R8M/Sheet1';

function escapeHtml(str) {
  return String(str ?? '')
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;");
}

async function loadSheet() {
  try {
    const res = await fetch(SHEET_JSON_URL);
    const data = await res.json();
    renderTable(data);
  } catch (e) {
    document.querySelector('#tbody').innerHTML =
      `<tr><td colspan="6">❌ Lỗi load sheet</td></tr>`;
    console.error(e);
  }
}

function renderTable(rows) {
  const tbody = document.querySelector('#tbody');
  tbody.innerHTML = '';

  rows.forEach((row, index) => {
    const platform =
      row.platform ||
      row.nen_tang ||
      row.Platform ||
      'VSPhone';

    const email =
      row.email ||
      row.Email ||
      row.mail ||
      row.tai_khoan ||
      '';

    const password =
      row.password ||
      row.pass ||
      row.mk ||
      row.mat_khau ||
      '';

    const status =
      row.status ||
      row.trang_thai ||
      'Sẵn sàng';

    console.log('[DEBUG]', { email, password });

    if (!email || !password) return;

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${index + 1}</td>
      <td>${escapeHtml(platform)}</td>
      <td>${escapeHtml(email)}</td>
      <td class="password-cell">${escapeHtml(password)}</td>
      <td>${escapeHtml(status)}</td>
      <td>
        <button class="btn login-btn"
          data-email="${escapeHtml(email)}"
          data-pass="${escapeHtml(password)}">
          Login
        </button>
      </td>
    `;
    tbody.appendChild(tr);
  });

  bindLoginButtons();
}

function bindLoginButtons() {
  document.querySelectorAll('.login-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const email = btn.dataset.email;
      const pass = btn.dataset.pass;

      console.log('[SAVE LOGIN]', email, pass);

      localStorage.setItem('VS_LOGIN_EMAIL', email);
      localStorage.setItem('VS_LOGIN_PASS', pass);

      window.open('https://cloud.vsphone.com/login', '_blank');
    });
  });
}

loadSheet();
</script>

</body>
</html>
