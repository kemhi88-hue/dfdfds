<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>VSPhone – Quản lý tài khoản (CSV)</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #fff;
  color: #000;
  padding: 20px;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}
th, td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: left;
}
th {
  background: #eee;
}
.btn {
  padding: 4px 8px;
  background: #007bff;
  color: #fff;
  border: none;
  cursor: pointer;
}
.btn:hover {
  background: #0056b3;
}
.error {
  color: red;
}
</style>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>

<h2>VSPhone – Quản lý tài khoản</h2>
<p>Dữ liệu load từ Google Sheets (CSV publish).</p>

<table>
  <thead>
    <tr>
      <th>Nền tảng</th>
      <th>Email</th>
      <th>Password</th>
      <th>Trạng thái</th>
      <th>Thao tác</th>
    </tr>
  </thead>
  <tbody id="tbody">
    <tr><td colspan="5">Đang tải dữ liệu...</td></tr>
  </tbody>
</table>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSyIS6NTiGHKz7BR5e8PEshKhRJWJcUC9bR8Gp5_WuqfsEGOwRdaARGcR-CwV7Dn_gUYRxcZ12Yb20I/pub?output=csv&gid=0";

function openLogin(email, password) {
  localStorage.setItem('VS_LOGIN_EMAIL', email.trim());
  localStorage.setItem('VS_LOGIN_PASS', password);
  window.open('https://cloud.vsphone.com/', '_blank');
}

function escapeHtml(s) {
  return String(s || "")
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;");
}

function renderTable(rows) {
  const tbody = document.getElementById("tbody");
  tbody.innerHTML = "";
  if (!rows || rows.length === 0) {
    tbody.innerHTML = '<tr><td colspan="5" class="error">Không có dữ liệu</td></tr>';
    return;
  }
  rows.forEach(row => {
    const tr = document.createElement("tr");
    const platform = escapeHtml(row["Nền tảng"] || "VSPhone");
    const email = escapeHtml(row["Email"] || "");
    const password = escapeHtml(row["Password"] || "");
    const status = escapeHtml(row["Trạng thái"] || "");
    tr.innerHTML = `
      <td>${platform}</td>
      <td>${email}</td>
      <td>${password}</td>
      <td>${status}</td>
      <td><button class="btn">LOGIN</button></td>
    `;
    tr.querySelector(".btn").addEventListener("click", () => openLogin(email, password));
    tbody.appendChild(tr);
  });
}

async function loadData() {
  try {
    const res = await fetch(CSV_URL);
    const text = await res.text();
    const parsed = Papa.parse(text, { header: true, skipEmptyLines: true });
    renderTable(parsed.data);
  } catch (e) {
    document.getElementById("tbody").innerHTML =
      `<tr><td colspan="5" class="error">Lỗi tải CSV: ${escapeHtml(e.message)}</td></tr>`;
  }
}

loadData();
</script>

</body>
</html>
