<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>VSPhone ‚Äì Qu·∫£n l√Ω t√†i kho·∫£n</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #fff;
  color: #000;
  padding: 20px;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}
th, td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: left;
}
th {
  background: #eee;
}
.btn {
  padding: 4px 10px;
  background: #007bff;
  color: #fff;
  border: none;
  cursor: pointer;
}
.btn:hover {
  background: #0056b3;
}
.password-cell {
  font-family: monospace;
}
.top-actions {
  margin-bottom: 15px;
}
</style>
</head>

<body>

<h2>VSPhone ‚Äì Qu·∫£n l√Ω t√†i kho·∫£n</h2>
<p>D·ªØ li·ªáu load tr·ª±c ti·∫øp t·ª´ Google Sheets.</p>

<!-- N√∫t ghim b√™n ngo√†i b·∫£ng -->
<div class="top-actions">
  <button class="btn" onclick="buyVSPhoneTrial()">üõí MUA VSPhone Trial</button>
</div>

<table id="accountTable">
  <thead>
    <tr>
      <th>#</th>
      <th>N·ªÅn t·∫£ng</th>
      <th>Email</th>
      <th>Password</th>
      <th>Tr·∫°ng th√°i</th>
      <th>Thao t√°c</th>
    </tr>
  </thead>
  <tbody id="tbody">
    <tr><td colspan="6">ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>
  </tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
const SHEET_JSON_URL =
  'https://opensheet.elk.sh/1fU4ppbOWDikPkEWUdXiyqrUn8JHXvt-PJjS778J-R8M/Trang%20t%C3%ADnh1';

async function loadSheet() {
  try {
    const res = await fetch(SHEET_JSON_URL);
    const data = await res.json();

    console.log('[SHEET DATA]', data);

    if (!Array.isArray(data) || data.length === 0) {
      document.querySelector('#tbody').innerHTML =
        '<tr><td colspan="6">‚ùå Sheet r·ªóng</td></tr>';
      return;
    }

    renderTable(data);
  } catch (e) {
    console.error(e);
    document.querySelector('#tbody').innerHTML =
      '<tr><td colspan="6">‚ùå L·ªói load sheet</td></tr>';
  }
}

function renderTable(rows) {
  const tbody = document.querySelector('#tbody');
  tbody.innerHTML = '';

  rows.forEach((row, i) => {
    const email = row.email?.trim();
    const pass = row.password?.trim();

    if (!email || !pass) return;

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${i + 1}</td>
      <td>${row.platform || 'VSPhone'}</td>
      <td>${email}</td>
      <td class="password-cell">${pass}</td>
      <td>${row.status || ''}</td>
      <td>
        <button class="btn" onclick="login('${email}','${pass}')">
          üöÄ LOGIN
        </button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function login(email, pass) {
  console.log('[LOGIN]', email, pass);

  // M·ªü tab login
  const newWin = window.open('https://cloud.vsphone.com/login', '_blank');

  // Chu·∫©n b·ªã d·ªØ li·ªáu g·ª≠i
  const creds = { type: 'AUTO_LOGIN', email, password: pass };
  const targetOrigin = 'https://cloud.vsphone.com';

  // G·ª≠i message sau 1 gi√¢y (ƒë·∫£m b·∫£o tab ƒë√£ load)
  setTimeout(() => {
    newWin.postMessage(creds, targetOrigin);
    console.log('[LOGIN] Credentials sent via postMessage');
  }, 1000);
}

// H√†m cho n√∫t MUA VSPhone Trial
function buyVSPhoneTrial() {
  window.location.href = "https://hoang.cloud";
}

loadSheet();

async function startAutoRegister() {
    // 1. L·∫•y d·ªØ li·ªáu t·ª´ c√°c √¥ Input tr√™n Web c·ªßa b·∫°n
    const email = document.getElementById('email_input_id').value;
    const password = document.getElementById('pass_input_id').value;
    const refCode = document.getElementById('ref_input_id').value;

    // 2. C·∫•u h√¨nh GitHub (C·∫ßn thay ƒë·ªïi 3 th√¥ng s·ªë n√†y)
    const GITHUB_TOKEN = "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"; // Token classic b·∫°n v·ª´a t·∫°o
    const OWNER = "kemhi88-hue";           // T√™n t√†i kho·∫£n GitHub c·ªßa b·∫°n
    const REPO = "dfdfds";           // T√™n kho l∆∞u tr·ªØ ch·ª©a file register.py

    // 3. G·ª≠i y√™u c·∫ßu k√≠ch ho·∫°t GitHub Actions
    try {
        const response = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/dispatches`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${GITHUB_TOKEN}`,
                'Accept': 'application/vnd.github.v3+json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                event_type: 'run-tool', // Ph·∫£i tr√πng v·ªõi "types" trong file .yml
                client_payload: {
                    email: email,
                    password: password,
                    ref: refCode
                }
            })
        });

        if (response.status === 204) {
            alert("üöÄ L·ªánh ƒë√£ g·ª≠i th√†nh c√¥ng! Tool ƒëang ch·∫°y ng·∫ßm tr√™n GitHub Actions.");
        } else {
            const errorData = await response.json();
            console.error(errorData);
            alert("‚ùå L·ªói: " + (errorData.message || "Kh√¥ng th·ªÉ k·∫øt n·ªëi GitHub"));
        }
    } catch (error) {
        console.error("Error:", error);
        alert("‚ùå ƒê√£ c√≥ l·ªói x·∫£y ra khi g·ª≠i y√™u c·∫ßu.");
    }
}  
</script>

</body>
</html>
